# ADR 0001: Выбор стека — FastAPI + Postgres + Qdrant

## Статус
Принято

## Контекст
Для MVP Trust требуется выбрать технологический стек, который:
- Поддерживает async/await для производительности
- Имеет хорошую поддержку type hints (для читаемости кода)
- Позволяет быстро итерировать
- Подходит для модульного монолита с перспективой масштабирования

## Решение
Используем следующий стек:

### Backend
- **Python 3.11** — современная версия с улучшенной производительностью
- **FastAPI** — async-first фреймворк, автоматическая документация, type hints

### База данных
- **Postgres** — основная реляционная БД
- **Qdrant** — векторная БД для embeddings и semantic search

### NLP
- **sentence-transformers** — локальная генерация embeddings
- Локальный пайплайн обработки (без облачных зависимостей по умолчанию)

### Инфраструктура
- **Docker Compose** — для локальной разработки и деплоя
- **Один backend-сервис** — модульный монолит

## Альтернативы, которые рассматривались

### NestJS (TypeScript)
**Плюсы:**
- Сильная типизация
- Модульная архитектура из коробки

**Минусы:**
- Команда более знакома с Python
- Для NLP pipeline Python более естественен

### Django
**Плюсы:**
- Богатая экосистема
- ORM из коробки

**Минусы:**
- Менее удобен для async
- Более тяжёлый для MVP

### Flask
**Плюсы:**
- Простота

**Минусы:**
- Нет встроенной поддержки async
- Требуется больше boilerplate для type hints

## Последствия

### Позитивные
- Быстрая разработка благодаря FastAPI
- Автоматическая OpenAPI документация
- Хорошая производительность за счёт async
- Легко интегрировать Python NLP библиотеки

### Негативные
- Python менее производителен, чем Go/Rust (для MVP не критично)
- При росте нагрузки может потребоваться оптимизация или переход части модулей на другие языки

### Риски и митигация
- **Риск:** FastAPI относительно молодой фреймворк
  - **Митигация:** Широкая поддержка сообщества, активная разработка

- **Риск:** Проблемы с GIL при CPU-intensive NLP задачах
  - **Митигация:** NLP pipeline можно вынести в отдельный процесс/сервис при необходимости

## Связанные решения
- ADR 0002 (Event Model) — событийная модель для взаимодействия модулей
- ADR 0003 (TODO) — выбор конкретных моделей sentence-transformers
