Trust — Архитектура MVP

Версия: v0.2 (рабочий документ для разработки)

Этот файл описывает техническую и продуктовую архитектуру MVP сервиса Trust.
Он дополняет concept.md и не дублирует философию, а отвечает на вопрос:
«Как именно мы это реализуем сейчас, чтобы потом не переделывать?»

⸻

1. Архитектурные принципы

1.1. Модульный монолит → микросервисы
	•	MVP реализуется как модульный монолит (один репозиторий, один деплой).
	•	Каждый модуль имеет чёткие границы ответственности.
	•	Любой модуль можно вынести в микросервис без изменения контрактов.

1.2. Event-first
	•	Взаимодействие модулей строится через события.
	•	Даже если технически используется in-process bus — событийная модель фиксируется сразу.

1.3. Privacy by default
	•	Raw-данные опыта всегда приватны.
	•	Ни один пользователь не имеет доступа к raw-опыту других.
	•	Внешние и аналитические контуры изолированы.

1.4. Честный MVP
	•	MVP может честно говорить «недостаточно данных».
	•	Мы не симулируем уверенность там, где её нет.

⸻

2. Основные контуры системы

2.1. Identity & Social Graph

Назначение:
	•	идентификация пользователя
	•	список друзей (1-hop)
	•	основа цепочки доверия

Минимум для MVP:
	•	user
	•	friendship

⸻

2.2. Experience (Память)

Raw Experience
	•	неизменяемое хранилище личного опыта
	•	текст или транскрипт голоса

Structured Experience
	•	домен (restaurants, gifts, travel, etc.)
	•	атрибуты (цена, атмосфера, риск и т.п.)
	•	короткое саммари
	•	embedding

Важно: raw и structured — разные сущности.

⸻

2.3. NLP Pipeline

Функции:
	•	определение домена
	•	извлечение атрибутов
	•	генерация саммари
	•	генерация embeddings

Подход:
	•	локальные open-source модели
	•	возможность заменить модель без изменения интерфейса

⸻

2.4. Vector Retrieval

Назначение:
	•	поиск опыта по смыслу
	•	фильтрация по уровням доверия

Технологии:
	•	Qdrant / FAISS

⸻

2.5. Trust Graph

Назначение:
	•	хранение связей доверия
	•	доменная релевантность друзей

MVP-логика:
	•	частота подтверждённых outcomes
	•	явные пользовательские пометки «доверяю X в Y» (опционально)

⸻

2.6. Answer Engine

Назначение:
	•	сбор релевантного опыта
	•	агрегация паттернов
	•	формирование ответа
	•	указание источников доверия

Ограничения:
	•	никакого raw-контента друзей
	•	только сигналы и атрибуты

⸻

2.7. Outcome & Feedback

Назначение:
	•	добровольная фиксация результата
	•	замыкание цикла доверия

Формы:
	•	помогло / не помогло / не знаю
	•	короткий текст или голос

⸻

2.8. Contribution (замыкание доверия)

Назначение:
	•	осознание пользователем своей роли в системе

Принципы:
	•	только приватно
	•	без имён и сравнений
	•	без точных чисел

Источник данных:
	•	recommendation.generated
	•	outcome.submitted
	•	experience.created

⸻

3. Основные пользовательские потоки

3.1. Ask → Answer
	1.	Пользователь задаёт вопрос
	2.	Определяется домен и intent
	3.	Retrieval по уровням доверия
	4.	Синтез ответа
	5.	Возврат результата

⸻

3.2. Add Experience
	1.	Пользователь фиксирует опыт
	2.	Raw сохраняется
	3.	NLP pipeline строит structured
	4.	Опыт становится доступен для ответов

⸻

3.3. Outcome
	1.	Система предлагает зафиксировать исход
	2.	Пользователь подтверждает или пропускает
	3.	Outcome влияет на доверие

⸻

4. Иерархия источников доверия
	1.	Личный опыт пользователя
	2.	Конкретные друзья
	3.	Друзья друзей (feature flag)
	4.	Внешний агрегированный опыт (fallback)

Каждый уровень явно маркируется в ответе.

⸻

5. Минимальная модель данных (укрупнённо)
	•	User
	•	Friendship
	•	ExperienceRaw
	•	ExperienceStructured
	•	Recommendation
	•	Outcome

⸻

6. Технологический стек MVP
	•	Backend: FastAPI или NestJS
	•	DB: Postgres
	•	Vector DB: Qdrant
	•	NLP: sentence-transformers (локально)
	•	Infra: Docker Compose

⸻

7. Что сознательно НЕ делаем в MVP
	•	ленты
	•	публичные профили
	•	рейтинги пользователей
	•	автотрекинг действий
	•	геймификацию

⸻

8. Критерии успеха MVP
	•	пользователь получает полезный ответ
	•	пользователь понимает, чьему опыту доверяет
	•	пользователь может зафиксировать исход < 10 секунд
	•	система честно признаёт неопределённость

⸻

9. Стратегический задел

Эта архитектура позволяет:
	•	добавить друзей друзей без рефакторинга
	•	подключить внешние источники как fallback
	•	развить B2B-аналитику в отдельном контуре
	•	масштабировать в микросервисы

⸻

Этот файл — рабочий артефакт для разработки.
Если решение противоречит этому документу — его нельзя принимать без пересмотра архитектуры.